#include "lfsr.h"

std::vector<LfsrParams> lfsr_params = {
	{3, {0,1}},
	{4, {0,1}},
	{5, {0,2}},
	{6, {0,1}},
	{7, {0,1}},
	{8, {0,2,3,4}},
	{9, {0,4}},
	{10, {0,3}},
	{11, {0,2}},
	{12, {0,1,4,6}},
	{13, {0,1,3,4}},
	{14, {0,1,3,5}},
	{15, {0,1}},
	{16, {0,2,3,5}},
	{17, {0,3}},
	{18, {0,7}},
	{19, {0,1,2,5}},
	{20, {0,3}},
	{21, {0,2}},
	{22, {0,1}},
	{23, {0,5}},
	{24, {0,1,3,4}},
	{25, {0,3}},
	{26, {0,1,2,6}},
	{27, {0,1,2,5}},
	{28, {0,3}},
	{29, {0,2}},
	{30, {0,1,4,6}},
	{31, {0,3}},
	{32, {0,2,6,7}},
	{33, {0,12}},
	{34, {0,3,4,8}},
	{35, {0,2}},
	{36, {0,11}},
	{37, {0,1,4,6}},
	{38, {0,1,5,6}},
	{39, {0,4}},
	{40, {0,3,4,5}},
	{41, {0,3}},
	{42, {0,2,5,7}},
	{43, {0,1,5,6}},
	{44, {0,2,5,6}},
	{45, {0,1,3,4}},
	{46, {0,6,7,8}},
	{47, {0,5}},
	{48, {0,4,7,9}},
	{49, {0,9}},
	{50, {0,2,3,4}},
	{51, {0,1,3,6}},
	{52, {0,3}},
	{53, {0,1,2,6}},
	{54, {0,3,6,8}},
	{55, {0,24}},
	{56, {0,2,4,7}},
	{57, {0,7}},
	{58, {0,19}},
	{59, {0,2,4,7}},
	{60, {0,1}},
	{61, {0,1,2,5}},
	{62, {0,3,5,6}},
	{63, {0,1}},
	{64, {0,1,3,4}},
	{65, {0,18}},
	{66, {0,6,8,9}},
	{67, {0,1,2,5}},
	{68, {0,9}},
	{69, {0,2,5,6}},
	{70, {0,1,3,5}},
	{71, {0,6}},
	{72, {0,3,9,10}},
	{73, {0,25}},
	{74, {0,3,4,7}},
	{75, {0,1,3,6}},
	{76, {0,2,4,5}},
	{77, {0,2,5,6}},
	{78, {0,1,2,7}},
	{79, {0,9}},
	{80, {0,2,4,9}},
	{81, {0,4}},
	{82, {0,4,6,9}},
	{83, {0,2,4,7}},
	{84, {0,13}},
	{85, {0,1,2,8}},
	{86, {0,2,5,6}},
	{87, {0,13}},
	{88, {0,8,9,11}},
	{89, {0,38}},
	{90, {0,2,3,5}},
	{91, {0,1,5,8}},
	{92, {0,2,5,6}},
	{93, {0,2}},
	{94, {0,21}},
	{95, {0,11}},
	{96, {0,6,9,10}},
	{97, {0,6}},
	{98, {0,11}},
	{99, {0,4,5,7}},
	{100, {0,37}},
	{101, {0,1,5,7}},
	{102, {0,3,5,6}},
	{103, {0,9}},
	{104, {0,1,10,11}},
	{105, {0,16}},
	{106, {0,15}},
	{107, {0,2,8,9}},
	{108, {0,31}},
	{109, {0,2,4,5}},
	{110, {0,1,4,6}},
	{111, {0,10}},
	{112, {0,4,6,11}},
	{113, {0,9}},
	{114, {0,1,2,11}},
	{115, {0,5,7,8}},
	{116, {0,2,5,6}},
	{117, {0,1,2,5}},
	{118, {0,33}},
	{119, {0,8}},
	{120, {0,2,6,9}},
	{121, {0,18}},
	{122, {0,1,2,6}},
	{123, {0,2}},
	{124, {0,37}},
	{125, {0,5,6,7}},
	{126, {0,2,4,7}},
	{127, {0,1}},
	{128, {0,1,2,7}},
	{255, {0,52}},
	{256, {0,2,5,10}},
	{511, {0,10}},
	{512, {0,2,5,8}},
	{1024, {0,9,22,23}},
	{2048, {0,13,14,19}},
	{4096, {0,1,15,27}},
};

/**
 * 適切な lfsr_param を探す
 */
LfsrParams find_lfsr_param(int32_t bit_size)
{
	for (auto& lfsr_param : lfsr_params) {
		if (lfsr_param.bit_size == bit_size) {
			return lfsr_param;
		}
	}
	return LfsrParams{};
}


uint64_t mseq( uint64_t mnumber, int32_t bit_size, const std::vector<uint32_t> &taps )
{
	uint64_t bit = 0;
	for (auto &&tap : taps)
	{
		bit ^= (mnumber >> tap);
	}
	bit &= 1;
	mnumber = (mnumber >> 1) | (bit << (bit_size - 1));
	return mnumber;
}
